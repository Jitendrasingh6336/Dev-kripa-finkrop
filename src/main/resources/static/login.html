
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Panel - DevKripa Fincorp</title>

<!-- Bootstrap CSS CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

<style>
    body {
        background: linear-gradient(135deg, #141e30, #243b55);
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .login-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        width: 380px;
        padding: 30px 25px;
    }
    .login-header {
        background: linear-gradient(90deg, #6a5acd, #9370db);
        padding: 20px;
        border-radius: 12px 12px 0 0;
        color: white;
        text-align: center;
        margin: -30px -25px 25px -25px;
        font-weight: 600;
    }
    .header-logo {
        height: 50px; /* logo size */
        width: auto;
        margin-bottom: 10px;
    }
    .form-control:focus {
        box-shadow: 0 0 0 0.25rem rgba(107, 90, 230, 0.5);
        border-color: #6a5acd;
    }
    .btn-login {
        background: linear-gradient(90deg, #6a5acd, #9370db);
        border: none;
        font-weight: 600;
    }
    .btn-login:hover {
        background: linear-gradient(90deg, #9370db, #6a5acd);
    }
    .input-group-text {
        background: transparent;
        border: none;
        color: #6a5acd;
    }
    .note-box {
        background: #eef2ff;
        color: #555;
        font-size: 0.85rem;
        border-radius: 6px;
        padding: 12px 15px;
        margin-top: 20px;
    }
    .back-link {
        display: block;
        margin-top: 12px;
        font-size: 0.9rem;
        color: #6a5acd;
        text-decoration: none;
        text-align: center;
    }
    .back-link:hover {
        text-decoration: underline;
    }
    .error-msg {
        color: #dc3545;
        font-size: 0.85rem;
        margin-top: 5px;
        display: none;
    }
    
    .auth-logo {
    width: 70px;
    height: 70px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
}

.auth-logo i {
    font-size: 2rem;
    color: #ffffff; /* icon color */
}
</style>

<!-- Bootstrap Icons CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>
<body>
<div class="login-container">
    <div class="login-header text-center">
       <div class="auth-logo">
    <i class="fas fa-shield-alt"></i>
</div>
            
        <h3>Admin Panel</h3>
        <small>DevKripa Fincorp Management</small>
    </div>

    <form id="loginForm" novalidate>
        <!-- Email -->
        <div class="mb-3 position-relative">
            <label for="email" class="form-label">Email Address</label>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-envelope-fill"></i></span>
                <input type="email" class="form-control" id="email" placeholder="Enter your Gmail" required>
            </div>
            <div class="error-msg" id="emailError">Please enter a valid Gmail address (e.g., user@gmail.com, user@gmail.co.in).</div>
        </div>

        <!-- Password -->
        <div class="mb-3 position-relative">
            <label for="password" class="form-label">Password</label>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-lock-fill"></i></span>
                <input type="password" class="form-control" id="password" placeholder="Enter your password" minlength="6" required>
                <button type="button" class="btn btn-outline-secondary" id="togglePassword" style="border-radius: 0 0.375rem 0.375rem 0;" title="Show/Hide Password">
                    <i class="bi bi-eye"></i>
                </button>
            </div>
            <div class="error-msg" id="passwordError">Password must be at least 6 characters.</div>
        </div>

        <!-- Submit -->
        <button type="submit" class="btn btn-login w-100" id="submitBtn" disabled>
            <i class="bi bi-box-arrow-in-right"></i> Login
        </button>

        <div class="note-box mt-4">
            <i class="bi bi-info-circle-fill"></i> Note: Admin accounts are created by Super Admin only.<br>
            Contact your Super Admin for access.
        </div>

        <a href="/" class="back-link">&larr; Back to Website</a>
    </form>
</div>

<script>
    // Toggle password visibility
    const togglePassword = document.querySelector("#togglePassword");
    const passwordInput = document.querySelector("#password");
    togglePassword.addEventListener("click", function () {
        const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
        passwordInput.setAttribute("type", type);
        this.querySelector("i").classList.toggle("bi-eye");
        this.querySelector("i").classList.toggle("bi-eye-slash");
    });

    // Form Validation
    const emailInput = document.querySelector("#email");
    const passwordInput2 = document.querySelector("#password");
    const emailError = document.querySelector("#emailError");
    const passwordError = document.querySelector("#passwordError");
    const submitBtn = document.querySelector("#submitBtn");
    const loginForm = document.querySelector("#loginForm");

    function validateEmail(email) {
        const gmailRegex = /^[a-zA-Z0-9._%+-]+@gmail(\.[a-z]{2,})+$/;
        return gmailRegex.test(email);
    }

    function validatePassword(password) {
        return password.length >= 6;
    }

    function validateForm() {
        const emailVal = emailInput.value.trim();
        const passwordVal = passwordInput2.value;

        let valid = true;

        if (!validateEmail(emailVal)) {
            emailError.style.display = "block";
            valid = false;
        } else {
            emailError.style.display = "none";
        }

        if (!validatePassword(passwordVal)) {
            passwordError.style.display = "block";
            valid = false;
        } else {
            passwordError.style.display = "none";
        }

        submitBtn.disabled = !valid;
        return valid;
    }

    emailInput.addEventListener("input", validateForm);
    passwordInput2.addEventListener("input", validateForm);

    // API Call
    loginForm.addEventListener("submit", function (e) {
        e.preventDefault(); // prevent default submit

        if (!validateForm()) return;

        const data = {
            email: emailInput.value.trim(),
            password: passwordInput2.value
        };

        const apiUrl = "http://localhost:9090/auth/api/v1/login"; // Replace with your API URL

        submitBtn.disabled = true;
        submitBtn.innerText = "Logging in...";

        fetch(apiUrl, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        })
        .then(res => res.json())
        .then(result => {
            submitBtn.disabled = false;
            submitBtn.innerText = "Login";

            if(result.success) {
                alert("Login successful!");
				const role = result.user.role; // ✅ get role from response
				localStorage.setItem("token", result.token);

				        // ✅ Role-based redirect
				        if(role === "ADMIN") {
							window.location.href = "/dashboard.html";

				        } 
				        else if(role === "USER") {
				            window.location.href = "/user/dashboard.jsp";
				        } 
				        else if(role === "MANAGER") {
				            window.location.href = "/manager/dashboard.jsp";
				        } 
				        else {
				            window.location.href = "/dashboard.jsp"; // default
				        }

            } else {
                alert(result.message || "Login failed. Please check credentials.");
            }
        })
        .catch(err => {
            console.error("API Error:", err);
            submitBtn.disabled = false;
            submitBtn.innerText = "Login";
            alert("Unable to connect to API.");
        });
    });

</script>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>